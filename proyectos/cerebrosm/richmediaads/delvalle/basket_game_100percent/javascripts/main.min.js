var CANVAS_WIDTH=280;var CANVAS_HEIGHT=230;var FPS=30;var COUNT_ENEMIES=0;var COUNT_ITEMS=0;var GAME_INTERVAL;$("#play").click(function(){$("#preview").css({"display":"none","visibility":"hidden"});$(".preview .lemon-container .lemon , .preview .lemon-container .bubbles").addClass("stop");setTimeout(function(){$("#instructions .texto_2").css({"display":"none","visibility":"hidden"});$("#instructions .texto_5").css({"display":"block","visibility":"visible"});$("#instructions .phone").css({"display":"block","visibility":"visible"});setTimeout(function(){$("#instructions").css({"display":"none","visibility":"hidden"});GAME_INTERVAL=setInterval(function(){update();draw();},1000/FPS);},3600);},2000);});$("#play-again").click(function(){$("#game-set").css({"display":"block","visibility":"visible"});$("#game-over").css({"display":"none","visibility":"hidden"});$("#success_2").css({"display":"none","visibility":"hidden"});$("#success").css({"display":"none","visibility":"hidden"});$("#counter-right-begin").html(0);$("#counter-left-begin").html(0);canvas.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);COUNT_ENEMIES=0;COUNT_ITEMS=0;vegetables_1=[];vegetables_2=[];vegetables_3=[];vegetables_4=[];vegetables_5=[];lemons=[];GAME_INTERVAL=setInterval(function(){update();draw();},1000/FPS);});$("#play-again-success").click(function(){$("#game-over").css({"display":"none","visibility":"hidden"});$("#success_2").css({"display":"none","visibility":"hidden"});$("#success").css({"display":"none","visibility":"hidden"});$("#game-set").css({"display":"block","visibility":"visible"});$("#counter-right-begin").html(0);$("#counter-left-begin").html(0);canvas.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);COUNT_ENEMIES=0;COUNT_ITEMS=0;vegetables_1=[];vegetables_2=[];vegetables_3=[];vegetables_4=[];vegetables_5=[];lemons=[];GAME_INTERVAL=setInterval(function(){update();draw();},1000/FPS);});if(window.DeviceMotionEvent){window.addEventListener('devicemotion',deviceMotionHandler,false);}
function deviceMotionHandler(eventData){var x=event.accelerationIncludingGravity.x*5;if(x<-2){player.x-=5;}
if(x>2){player.x+=5;}}
var player={color:"#00A",x:50,y:197,width:50,height:33,draw:function(){canvas.fillStyle=this.color;canvas.fillRect(this.x,this.y,this.width,this.height);}};vegetables_1=[];vegetables_2=[];vegetables_3=[];vegetables_4=[];vegetables_5=[];lemons=[];function Vegetable_1(I){I=I||{};I.active=true;I.age=Math.floor(Math.random()*128);I.color="#A2B";I.x=CANVAS_WIDTH / 4+Math.random()*CANVAS_WIDTH / 2;I.y=0;I.xVelocity=0
I.yVelocity=1.5;I.width=32;I.height=32;I.inBounds=function(){return I.x>=0&&I.x<=CANVAS_WIDTH&&I.y>=0&&I.y<=CANVAS_HEIGHT;};I.sprite=Sprite("vegetable_1");I.draw=function(){this.sprite.draw(canvas,this.x,this.y);};I.update=function(){I.x+=I.xVelocity;I.y+=I.yVelocity;I.xVelocity=3*Math.sin(I.age*Math.PI / 64);I.age++;I.active=I.active&&I.inBounds();};I.explode=function(){Sound.play("explosion");this.active=false;};return I;};function Vegetable_2(I){I=I||{};I.active=true;I.age=Math.floor(Math.random()*128);I.color="#A2B";I.x=CANVAS_WIDTH / 4+Math.random()*CANVAS_WIDTH / 2;I.y=0;I.xVelocity=0
I.yVelocity=1.2;I.width=32;I.height=32;I.inBounds=function(){return I.x>=0&&I.x<=CANVAS_WIDTH&&I.y>=0&&I.y<=CANVAS_HEIGHT;};I.sprite=Sprite("vegetable_2");I.draw=function(){this.sprite.draw(canvas,this.x,this.y);};I.update=function(){I.x+=I.xVelocity;I.y+=I.yVelocity;I.xVelocity=2*Math.sin(I.age*Math.PI / 64);I.age++;I.active=I.active&&I.inBounds();};I.explode=function(){Sound.play("explosion");this.active=false;};return I;};function Vegetable_3(I){I=I||{};I.active=true;I.age=Math.floor(Math.random()*128);I.color="#A2B";I.x=CANVAS_WIDTH / 4+Math.random()*CANVAS_WIDTH / 2;I.y=0;I.xVelocity=0
I.yVelocity=1.2;I.width=32;I.height=32;I.inBounds=function(){return I.x>=0&&I.x<=CANVAS_WIDTH&&I.y>=0&&I.y<=CANVAS_HEIGHT;};I.sprite=Sprite("vegetable_3");I.draw=function(){this.sprite.draw(canvas,this.x,this.y);};I.update=function(){I.x+=I.xVelocity;I.y+=I.yVelocity;I.xVelocity=2*Math.sin(I.age*Math.PI / 64);I.age++;I.active=I.active&&I.inBounds();};I.explode=function(){Sound.play("explosion");this.active=false;};return I;};function Vegetable_4(I){I=I||{};I.active=true;I.age=Math.floor(Math.random()*128);I.color="#A2B";I.x=CANVAS_WIDTH / 4+Math.random()*CANVAS_WIDTH / 2;I.y=0;I.xVelocity=0
I.yVelocity=1.2;I.width=32;I.height=32;I.inBounds=function(){return I.x>=0&&I.x<=CANVAS_WIDTH&&I.y>=0&&I.y<=CANVAS_HEIGHT;};I.sprite=Sprite("vegetable_4");I.draw=function(){this.sprite.draw(canvas,this.x,this.y);};I.update=function(){I.x+=I.xVelocity;I.y+=I.yVelocity;I.xVelocity=2*Math.sin(I.age*Math.PI / 64);I.age++;I.active=I.active&&I.inBounds();};I.explode=function(){Sound.play("explosion");this.active=false;};return I;};function Vegetable_5(I){I=I||{};I.active=true;I.age=Math.floor(Math.random()*128);I.color="#A2B";I.x=CANVAS_WIDTH / 4+Math.random()*CANVAS_WIDTH / 2;I.y=0;I.xVelocity=0
I.yVelocity=1.2;I.width=32;I.height=32;I.inBounds=function(){return I.x>=0&&I.x<=CANVAS_WIDTH&&I.y>=0&&I.y<=CANVAS_HEIGHT;};I.sprite=Sprite("vegetable_5");I.draw=function(){this.sprite.draw(canvas,this.x,this.y);};I.update=function(){I.x+=I.xVelocity;I.y+=I.yVelocity;I.xVelocity=2*Math.sin(I.age*Math.PI / 64);I.age++;I.active=I.active&&I.inBounds();};I.explode=function(){Sound.play("explosion");this.active=false;};return I;};function Lemon(I){I=I||{};I.active=true;I.age=Math.floor(Math.random()*128);I.color="#A2B";I.x=CANVAS_WIDTH / 4+Math.random()*CANVAS_WIDTH / 2;I.y=0;I.xVelocity=0
I.yVelocity=1.2;I.width=50;I.height=54;I.inBounds=function(){return I.x>=0&&I.x<=CANVAS_WIDTH&&I.y>=0&&I.y<=CANVAS_HEIGHT;};I.sprite=Sprite("lemon");I.draw=function(){this.sprite.draw(canvas,this.x,this.y);};I.update=function(){I.x+=I.xVelocity;I.y+=I.yVelocity;I.xVelocity=2*Math.sin(I.age*Math.PI / 64);I.age++;I.active=I.active&&I.inBounds();};I.explode=function(){Sound.play("item");this.active=false;};return I;};var canvasElement=$("<canvas id='canvas' width='"+CANVAS_WIDTH+"' height='"+CANVAS_HEIGHT+"'></canvas");var canvas=canvasElement.get(0).getContext("2d");canvasElement.appendTo($("#game-set"));function update(){if(keydown.left){player.x-=5;}
if(keydown.right){player.x+=5;}
player.x=player.x.clamp(0,CANVAS_WIDTH-player.width);vegetables_1.forEach(function(enemy){enemy.update();});vegetables_1=vegetables_1.filter(function(enemy){return enemy.active;});vegetables_2.forEach(function(enemy){enemy.update();});vegetables_2=vegetables_2.filter(function(enemy){return enemy.active;});vegetables_3.forEach(function(enemy){enemy.update();});vegetables_3=vegetables_3.filter(function(enemy){return enemy.active;});vegetables_4.forEach(function(enemy){enemy.update();});vegetables_4=vegetables_4.filter(function(enemy){return enemy.active;});vegetables_5.forEach(function(enemy){enemy.update();});vegetables_5=vegetables_5.filter(function(enemy){return enemy.active;});lemons.forEach(function(item){item.update();});lemons=lemons.filter(function(item){return item.active;});handleCollisions();if(Math.random()<0.010){vegetables_1.push(Vegetable_1());}
if(Math.random()<0.011){vegetables_2.push(Vegetable_2());}
if(Math.random()<0.012){vegetables_3.push(Vegetable_3());}
if(Math.random()<0.013){vegetables_4.push(Vegetable_4());}
if(Math.random()<0.014){vegetables_5.push(Vegetable_5());}
if(Math.random()<0.016){lemons.push(Lemon());}}
player.shoot=function(){Sound.play("shoot");};player.midpoint=function(){return{x:this.x+this.width/2,y:this.y+this.height/2};};function draw(){canvas.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);player.draw();vegetables_1.forEach(function(enemy){enemy.draw();});vegetables_2.forEach(function(enemy){enemy.draw();});vegetables_3.forEach(function(enemy){enemy.draw();});vegetables_4.forEach(function(enemy){enemy.draw();});vegetables_5.forEach(function(enemy){enemy.draw();});lemons.forEach(function(item){item.draw();});}
function collides(a,b){return a.x<b.x+b.width&&a.x+a.width>b.x&&a.y<b.y+b.height&&a.y+a.height>b.y;}
function handleCollisions(){vegetables_1.forEach(function(enemy){if(collides(enemy,player)){enemy.explode();player.explode();}});vegetables_2.forEach(function(enemy){if(collides(enemy,player)){enemy.explode();player.explode();}});vegetables_3.forEach(function(enemy){if(collides(enemy,player)){enemy.explode();player.explode();}});vegetables_4.forEach(function(enemy){if(collides(enemy,player)){enemy.explode();player.explode();}});vegetables_5.forEach(function(enemy){if(collides(enemy,player)){enemy.explode();player.explode();}});lemons.forEach(function(item){if(collides(item,player)){item.explode();player.won();}});}
player.explode=function(){this.active=false;COUNT_ENEMIES++;$("#counter-left-begin").html(COUNT_ENEMIES);$("#counter-result-bads").html(COUNT_ENEMIES);};player.won=function(){this.active=true;COUNT_ITEMS++;$("#counter-right-begin").html(COUNT_ITEMS);$("#counter-result-goods").html(COUNT_ITEMS);if(COUNT_ITEMS>=4){clearInterval(GAME_INTERVAL);$("#game-set").css({"display":"none","visibility":"hidden"});$("#game-over").css({"display":"none","visibility":"hidden"});$("#success_2").css({"display":"none","visibility":"hidden"});$("#success").css({"display":"block","visibility":"visible"});setTimeout(function(){$("#success").css({"display":"none","visibility":"hidden"});$("#success_2").css({"display":"block","visibility":"visible"});},4000);}};player.sprite=Sprite("basket");player.draw=function(){this.sprite.draw(canvas,this.x,this.y);};window.onresize=function(event){var windowWidth=$(window).width()-20;var windowHeight=$(window).height()-20;$("#canvas").css({"width":windowWidth+"px","height":windowHeight+"px"}).attr("width",windowWidth).attr("height",windowHeight);CANVAS_WIDTH=windowWidth;CANVAS_HEIGHT=windowHeight;canvas.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);player.y=windowHeight-33;};var windowWidth=$(window).width()-20;var windowHeight=$(window).height()-20;$("#canvas").css({"width":windowWidth+"px","height":windowHeight+"px"}).attr("width",windowWidth).attr("height",windowHeight);CANVAS_WIDTH=windowWidth;CANVAS_HEIGHT=windowHeight;canvas.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);player.y=windowHeight-33;

<!DOCTYPE html>
<html lang="es">
<head>

	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Description -->
	<title></title>
	<meta content="" name="description">
  	<meta content="" name="keywords">

	<!-- Icons -->
	<link rel="shortcut icon" href="recursos/images/favicons/favicon.ico">

	<!-- Social -->

		<!-- Facebook -->
	<meta property="og:url" content="" />
    <meta property="og:title" content="" />
    <meta property="og:description" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:image" content="" />

		<!-- Twitter -->
	<meta content="summary_large_image" name="twitter:card">
    <meta content="" name="twitter:title">
    <meta content="" name="twitter:description">
    <meta content="@" name="twitter:site">
    <meta content="@" name="twitter:creator">
    <meta content="" name="twitter:domain">
    <meta content="" name="twitter:image:src">

	<!-- Stylesheets -->
	<link type="text/css" rel="stylesheet" href="recursos/css/font-awesome.css"/>
	<link type="text/css" rel="stylesheet" href="recursos/css/bootstrap.css"/>
	<link type="text/css" rel="stylesheet" href="recursos/css/animate.css"/>

	<!-- Stylesheets for older browsers -->
	<!-- IE6/7 micro clearfix -->
	<!--[if lte IE 7]>
		<style>
			.grouping {
				*zoom: 1;
			}
		</style>
	<![endif]-->
	<!--[if IE]>
		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<!-- Javascript -->

	<style type="text/css">
		.isvisible{
			opacity: 0;
		}
	</style>

</head>
<body>

	<!-- Bootstrap Template -->

	<div class="container">

		<div class="row">

			<div class="col-md-4">

				<h4>Sincroniza tu dispositivo móvil con este código y asombrate</h4>
				<h1 id="code-number"></h1>

			</div><!-- Col-md-12 -->

			<div class="col-md-8">

				<div class="embed-responsive embed-responsive-16by9">
					<div class="isvisible embed-responsive-item" id="player"></div>
				</div>

			</div>

		</div>

	</div><!-- Container -->

	<!-- End Bootstrap Template -->

	<!-- Javascript -->
	<script type="text/javascript" src="recursos/js/jquery-1.11.2.js"></script>
	<script type="text/javascript" src="recursos/js/bootstrap.js"></script>
	<script type="text/javascript" src="https://js.pusher.com/3.0/pusher.min.js"></script>

	<script type="text/javascript">

		// 2. This code loads the IFrame Player API code asynchronously.
	  var tag = document.createElement('script');

	  tag.src = "https://www.youtube.com/iframe_api";
	  var firstScriptTag = document.getElementsByTagName('script')[0];
	  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

	  // 3. This function creates an <iframe> (and YouTube player)
	  //    after the API code downloads.
	  var player;
	  function onYouTubeIframeAPIReady() {
	    player = new YT.Player('player', {
	      height: '320',
	      width: '480',
	      videoId: 'M7lc1UVf-VE',
	      events: {
	        'onReady': onPlayerReady,
	        'onStateChange': onPlayerStateChange
	      }
	    });
	  }

	  // 4. The API will call this function when the video player is ready.
	  function onPlayerReady(event) {
	    //event.target.playVideo();
	  }

	  // 5. The API calls this function when the player's state changes.
	  //    The function indicates that when playing a video (state=1),
	  //    the player should play for six seconds and then stop.
	  var done = false;
	  function onPlayerStateChange(event) {
	    if (event.data == YT.PlayerState.PLAYING) {
				console.log("Se va a mandar a reproducir el otro video");
	    }
	  }

	  function stopVideo() {
	    player.stopVideo();
	  }

		function playVideo() {
	    player.playVideo();
	  }


	function random(length){
    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    var result = '';
    for (var i = length; i > 0; --i) result += chars[Math.round(Math.random() * (chars.length - 1))];
    return result;
  }

	$(document).ready(function(){

		var rndNumber = random(5);
	  $("#code-number").html(rndNumber);

		Pusher.log = function(message) {
	    if (window.console && window.console.log) {
	      window.console.log(message);
	    }
	  };

	  var pusher = new Pusher('fff12bb284dea31b5200', {
	      encrypted: true,
	      authEndpoint: 'recursos/php/pusher/auth.php'
	  });

	  var channel = pusher.subscribe('presence_channel_' + rndNumber);

	  channel.bind('pusher:subscription_succeeded', function() {
	    console.log("Suscripcion con exito");
	  });

		channel.bind('video_desktopl', function(data) {
	    console.log("Excelente, play");
			$("#player").removeClass("isvisible");
			playVideo();
	  });

		channel.bind('video_desktopa', function(data) {
	    console.log("Excelente, pause");
			$("#player").removeClass("isvisible");
			stopVideo();
	  });

	});


	</script>

</body>
<html>
